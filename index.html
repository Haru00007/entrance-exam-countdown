<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カウントダウンタイマー</title>
    <style>
        /* (CSSに変更はありません) */
        @font-face {
            font-family: 'DSEG7 Classic';
            src: url('./fonts/DSEG7Classic-Bold.woff2') format('woff2');
            font-weight: bold; font-style: normal;
        }
        @font-face {
            font-family: 'DSEG14 Classic';
            src: url('./fonts/DSEG14Classic-Bold.woff2') format('woff2');
            font-weight: bold; font-style: normal;
        }
        @font-face {
            font-family: 'LED Calculator';
            src: url('./fonts/LEDCALCULATOR.TTF') format('truetype');
        }
        @font-face {
            font-family: 'Ktai-Dot-Font-LCD';
            src: url('./fonts/Ketai-dot-font-LCD.otf') format('opentype');
        }
        body {
            background-color: #000;
            font-family: 'DSEG7 Classic', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }
        .container { transform: scale(1.5); }
        .countdown, .current-time { margin-bottom: 40px; }
        .dseg14 { font-family: 'DSEG14 Classic', sans-serif; }
        .countdown span, .current-time span { letter-spacing: 4px; }
        .space { margin: 0 10px; }
        [data-placeholder] { position: relative; }
        [data-placeholder]::before {
            content: attr(data-placeholder);
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            color: rgba(255, 255, 255, 0.05);
        }
        #countdown-ms { font-size: 40px; color: white; }
        #day, #msec { color: orange; }
        #hour { font-size: 32px; color: red; position: relative; top: -2px; }
        #countdown-dh { font-size: 2em; }
        #current-date, #current-hms { font-size: 2em; color: white; }
        .jihou-highlight { color: red !important; transition: color 0.05s; }
        #day { display: inline-block; width: 115px; text-align: right; }
        #countdown-dh-labels {
            font-family: 'LED Calculator', sans-serif; 
            font-size: 14px; color: orange; letter-spacing: 1px;
            margin-top: 5px; display: flex; justify-content: center; align-items: center;
        }
        #day-label { width: 120px; text-align: right; }
        #hour-label { width: 90px; text-align: right; }
        #msec-label { width: 120px; }
        #message-area {
            font-family: 'Ktai-Dot-Font-LCD', sans-serif;
            font-size: 24px;
            color: #0d0;
            letter-spacing: 2px;
            margin-bottom: 30px;
            height: 24px;
            position: relative;
        }
        #message-area::after {
            content: '_';
            position: absolute;
            animation: blink 1s step-end infinite;
            font-family: 'LED Calculator', sans-serif;
        }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- (HTMLは変更なし) -->
        <div id="message-area"></div>
        <div class="countdown">
            <div id="countdown-ms"><span id="min" data-placeholder="88">00</span>:<span id="sec" data-placeholder="88">00</span></div>
            <div id="countdown-dh"><span id="day" data-placeholder="888">0</span><span class="space"></span><span id="hour" data-placeholder="88">00</span><span class="space"></span><span id="msec" data-placeholder="888">000</span></div>
            <div id="countdown-dh-labels"><span id="day-label" class="label-unit">Days</span><span class="space"></span><span id="hour-label" class="label-unit">Hours</span><span class="space"></span><span id="msec-label" class="label-unit">ms</span></div>
        </div>
        <div class="current-time">
            <div id="current-date"><span id="year" data-placeholder="8888">2025</span>-<span id="month" data-placeholder="88">09</span>-<span id="date" data-placeholder="88">22</span><span class="dseg14" id="day-of-week" data-placeholder="***">MON</span></div>
            <div id="current-hms"><span id="current-hour" data-placeholder="88">21</span>:<span id="current-min" data-placeholder="88">25</span>:<span id="current-sec" data-placeholder="88">15</span>.<span id="current-msec" data-placeholder="8">0</span></div>
        </div>
    </div>

    <script>
        // --- 設定項目 ---
        const targetDate = new Date("2026-01-17T00:00:00");
        const TYPING_SPEED = 150;
        const DELETING_SPEED = 100;
        const GREETING_STAY_DURATION = 5000;

        // --- 祝日リスト (YYYY-MM-DD形式) ---
        const holidays = [
            '2025-01-01', '2025-01-13', '2025-02-11', '2025-02-24', '2025-03-20',
            '2025-04-29', '2025-05-03', '2025-05-04', '2025-05-05', '2025-05-06',
            '2025-07-21', '2025-08-11', '2025-09-15', '2025-09-23', '2025-10-13',
            '2025-11-03', '2025-11-24'
        ];
        
        // ▼▼▼ 変更 ▼▼▼
        const randomMessages = [
            "キョウツウテストマデ アト DDDニチ!",
            "シッテタ? キュウジツハアトddニチシカナインダヨ!",
            "ナニヤッテルンデスカ、 ベンキョウシテクダサイ!",
            "ガンバルアナタヲ オウエンシテイマス。",
            "ヒトヤスミモ ダイジデスヨ。",
            "ベンキョウ ガンバレヨ!",
            "イママデノドリョクヲ シンジテ。",
            "キミナラ デキル!",
            "ラストスパート ダ!",
            "サイコウノハルヲ ムカエヨウ!",
            "ムリシスギナイデネ。",
            "ヒトリジャナイヨ。",
            "アトスコシノ シンボウ...",
            "コンディションヲ トトノエテ。",
            "ケッカハ カナラズツイテクル。",
            "オワッタラ パーットアソボウゼ!"
        ];

        // --- HTML要素の取得 (変更なし) ---
        const minEl=document.getElementById('min'),secEl=document.getElementById('sec'),dayEl=document.getElementById('day'),hourEl=document.getElementById('hour'),msecEl=document.getElementById('msec'),yearEl=document.getElementById('year'),monthEl=document.getElementById('month'),dateEl=document.getElementById('date'),dayOfWeekEl=document.getElementById('day-of-week'),currentHourEl=document.getElementById('current-hour'),currentMinEl=document.getElementById('current-min'),currentSecEl=document.getElementById('current-sec'),currentMsecEl=document.getElementById('current-msec'),dayLabelEl=document.getElementById('day-label'),hourLabelEl=document.getElementById('hour-label'),currentHmsEl=document.getElementById('current-hms'),messageEl=document.getElementById('message-area');

        // --- グローバル変数 ---
        const weekdays = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"];
        let lastSecond = -1, highlightUntil = 0;
        let currentDays = 0, remainingHolidays = 0;
        let currentMessageLogicHour = -1;
        let lastCheckedDate = null;

        // --- 便利な関数 ---
        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));
        
        function calculateRemainingHolidays(target) {
            let holidayCount = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            for (let d = today; d < target; d.setDate(d.getDate() + 1)) {
                const dayOfWeek = d.getDay();
                const dateString = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                if (dayOfWeek === 0 || dayOfWeek === 6 || holidays.includes(dateString)) {
                    holidayCount++;
                }
            }
            return holidayCount;
        }

        function updateTimer() {
            const now = new Date();
            const todayDate = now.getDate();
            if (todayDate !== lastCheckedDate) {
                remainingHolidays = calculateRemainingHolidays(targetDate);
                lastCheckedDate = todayDate;
            }
            // (以降の長い処理は変更がないため省略します)
            const diff = targetDate.getTime()-now.getTime();if(diff>0){const e=Math.floor(diff/864e5),t=Math.floor(diff%864e5/36e5),a=Math.floor(diff%36e5/6e4),n=Math.floor(diff%6e4/1e3),o=diff%1e3;currentDays=e,minEl.textContent=String(a).padStart(2,"0"),secEl.textContent=String(n).padStart(2,"0"),dayEl.textContent=String(e),hourEl.textContent=String(t).padStart(2,"0"),msecEl.textContent=String(o).padStart(3,"0"),dayLabelEl.textContent=1===e?"Day":"Days",hourLabelEl.textContent=1===t?"Hour":"Hours"}const e=now.getHours(),t=now.getMinutes(),a=now.getSeconds();yearEl.textContent=String(now.getFullYear()).padStart(4,"0"),monthEl.textContent=String(now.getMonth()+1).padStart(2,"0"),dateEl.textContent=String(now.getDate()).padStart(2,"0"),dayOfWeekEl.textContent=weekdays[now.getDay()],currentHourEl.textContent=String(e).padStart(2,"0"),currentMinEl.textContent=String(t).padStart(2,"0"),currentSecEl.textContent=String(a).padStart(2,"0"),currentMsecEl.textContent=Math.floor(now.getMilliseconds()/100),a!==lastSecond&&(59===t&&(57===a||58===a||59===a)&&(highlightUntil=now.getTime()+100),lastSecond=a);const n=0===t&&a<5,o=now.getTime()<highlightUntil;n||o?currentHmsEl.classList.add("jihou-highlight"):currentHmsEl.classList.remove("jihou-highlight");
        }

        async function messageSequenceManager() {
            const type = async (text) => { for (let i = 0; i < text.length; i++) { messageEl.textContent = text.substring(0, i + 1); await sleep(TYPING_SPEED); } };
            const del = async () => { const t = messageEl.textContent; for (let e = t.length; e > 0; e--) { messageEl.textContent = t.substring(0, e - 1); await sleep(DELETING_SPEED); } };

            timeZoneLoop:
            while (true) {
                const hour = new Date().getHours();
                currentMessageLogicHour = hour;
                let greeting = "";
                if (hour >= 5 && hour < 10) greeting = "オハヨウゴザイマス";
                else if (hour >= 10 && hour < 17) greeting = "コンニチハ";
                else greeting = "コンバンワ";

                await type(greeting);
                await sleep(GREETING_STAY_DURATION);
                if (new Date().getHours() !== currentMessageLogicHour) { await del(); continue timeZoneLoop; }
                await del();

                while (new Date().getHours() === currentMessageLogicHour) {
                    let rawMsg = randomMessages[Math.floor(Math.random() * randomMessages.length)];
                    let processedMsg = rawMsg;
                    
                    if (rawMsg.includes('DDD')) {
                        processedMsg = rawMsg.replace('DDD', currentDays);
                    }
                    // ▼▼▼ 変更 ▼▼▼
                    if (rawMsg.includes('dd')) {
                        processedMsg = rawMsg.replace('dd', remainingHolidays);
                    }
                    
                    await type(processedMsg);
                    
                    const randomStayDuration = 5000 + Math.random() * 5000;
                    const endTime = new Date().getTime() + randomStayDuration;
                    while (new Date().getTime() < endTime) {
                        if (new Date().getHours() !== currentMessageLogicHour) { await del(); continue timeZoneLoop; }
                        await sleep(1000);
                    }
                    await del();
                    await sleep(500);
                }
            }
        }

        // --- 処理の開始 ---
        setInterval(updateTimer, 1);
        messageSequenceManager();
    </script>
</body>
</html>